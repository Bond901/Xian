<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»™ (Xian) Kiosk è‡ªå‹•é»é¤ DEMO - ä»‹é¢ä¿®å¾©èˆ‡ä½ˆå±€å¼·åŒ–</title>
    <style>
        /* --- å“ç‰Œé¡è‰²èˆ‡æ¨¡å¼è®Šæ•¸ --- */
        :root {
            --day-color: #5a8d71; 
            --night-color: #1a4d4d; 
            --accent-color: #d9534f; 
            --main-theme: var(--day-color);
            --light-bg: #f9f9f9;
            --dark-bg: #fff;
            --main-text: #333;
            --disabled-color: #ccc;
            /* è¦–è¦ºå„ªåŒ–ï¼šé¸ä¸­æŒ‰éˆ•å¼·èª¿è‰² */
            --active-bg-day: #5a8d71;
            --active-border-day: #3a684b; 
            --active-bg-night: #3e8080;
            --active-border-night: #245858;
        }

        /* --- å¤œé–“æ¨¡å¼æ¨£å¼è¦†è“‹ (ç²¾ç°¡ä¸¦ä¿®æ­£) --- */
        .night-mode {
            --main-theme: var(--night-color);
            --light-bg: #3a3a3a;
            --dark-bg: #2b2b2b;
            --main-text: #f0f0f0;
            --disabled-color: #555;
            color: var(--main-text);
        }
        .night-mode .kiosk-container { background-color: var(--dark-bg); }
        .night-mode .top-bar { background-color: var(--light-bg); border-bottom-color: #555; }
        .night-mode .item-card { background-color: #333; border-color: #555; }
        .night-mode .item-card p { color: #ccc; }
        .night-mode .order-panel { background-color: #333; color: #fff; border-top-color: #555; }
        .night-mode .custom-header, .night-mode .option-box { background-color: var(--light-bg); border-bottom-color: #555; }
        .night-mode .product-detail-box { background-color: #3a3a3a; border-left-color: var(--main-theme); }
        .night-mode .product-detail-box p { color: #ccc; }
        .night-mode .custom-footer { background-color: #333; }
        .night-mode .option-group button { background-color: #444; border-color: #555; color: #eee; }
        .night-mode .option-group button.active {
            background-color: var(--active-bg-night);
            color: white;
            border-color: var(--active-border-night);
        }

        /* --- åŸºç¤æ’ç‰ˆèˆ‡ Kiosk æ¨¡æ“¬ (500pxå¯¬åº¦) --- */
        body {
            font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding-top: 20px;
            color: var(--main-text);
            background-color: var(--dark-bg);
            overflow: hidden; 
        }

        .kiosk-container {
            width: 500px; 
            max-height: 888px;
            min-height: 800px;
            background-color: var(--dark-bg);
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            overflow: hidden; 
            display: flex;
            flex-direction: column; 
            position: relative;
        }

        /* --- é ‚éƒ¨/èœå–®/å¡ç‰‡ --- */
        .top-bar { 
            flex-shrink: 0; 
            background-color: var(--light-bg); 
            border-bottom: 1px solid #ddd; 
            padding-bottom: 5px; /* ç‚º mode-switcher ç•™ç™½ */
        }
        .mode-switcher { padding: 10px 20px 0; text-align: center; }
        .mode-switcher p { margin: 0 0 5px 0; }
        .mode-switcher button { padding: 8px 15px; border: 1px solid var(--main-theme); background: none; color: var(--main-text); border-radius: 5px; margin: 0 5px; cursor: pointer; transition: all 0.2s; }
        .mode-switcher button.active-mode { background-color: var(--main-theme); color: white; }
        .header { padding: 5px 20px 15px; text-align: center; }
        .header h1 { color: var(--main-theme); font-size: 1.6em; margin: 0; }
        .header p { font-size: 0.8em; margin: 5px 0 0 0; color: #888; }
        
        .main-content { 
            flex-grow: 1; /* ä½”ç”¨å‰©é¤˜ç©ºé–“ */
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
        }
        
        /* èœå–®é …ç›®åˆ—è¡¨ - å”¯ä¸€å¯æ»¾å‹•å€åŸŸ */
        .menu-items-container {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
        }
        .menu-items { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        
        .item-card {
            background-color: var(--dark-bg);
            border: 1px solid #ccc;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            overflow: hidden;
            padding-bottom: 10px;
            position: relative;
            transition: transform 0.1s;
        }
        .item-card:hover { transform: scale(1.02); }
        .item-card img { width: 100%; height: auto; aspect-ratio: 4/3; object-fit: cover; margin-bottom: 5px; }
        .item-card h3 { font-size: 1.1em; margin: 5px 0; }
        .item-card p { font-size: 0.75em; color: #888; margin: 0 0 5px 0; height: 1.2em; overflow: hidden; }
        .item-card .price { font-size: 1.2em; font-weight: bold; color: var(--accent-color); }
        .info-btn {
            background: rgba(255, 255, 255, 0.7);
            color: var(--main-theme);
            border: 1px solid var(--main-theme);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            line-height: 28px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            padding: 0;
        }


        /* --- è¨‚å–®é¢æ¿ (Order Panel) --- */
        .order-panel { 
            flex-shrink: 0; 
            background-color: #f0f0f0; 
            border-top: 1px solid #ddd;
            padding: 15px;
        }
        .order-summary h2 { margin-top: 0; font-size: 1.2em; color: var(--main-theme); }
        .order-list { list-style: none; padding: 0; max-height: 120px; overflow-y: auto; margin: 10px 0; }
        .order-list li { padding: 5px 0; border-bottom: 1px dotted #ccc; font-size: 0.9em; }
        .order-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .total-display { font-size: 1.6em; font-weight: bold; color: var(--accent-color); }
        .checkout-btn { background-color: var(--main-theme); color: white; padding: 12px 20px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; }


        /* --- æ»¿ç‰ˆå®¢è£½åŒ–é é¢ (Customization Page) --- */
        .customization-page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark-bg);
            z-index: 500;
            display: none;
            flex-direction: column;
            overflow: hidden; 
        }
        
        /* é ‚éƒ¨ï¼šç”¢å“è³‡è¨Šèˆ‡è¿”å› */
        .custom-header {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--light-bg);
            border-bottom: 1px solid #ddd;
            position: relative;
        }
        /* è¿”å›æŒ‰éˆ• (å·¦ä¸Šè§’) */
        .back-button { 
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px 10px;
            color: var(--main-theme);
            z-index: 510; 
        }
        .custom-header-img { width: 80px; height: 60px; object-fit: cover; border-radius: 8px; margin-right: 15px; margin-left: 40px; /* ç‚ºè¿”å›æŒ‰éˆ•é¨°å‡ºç©ºé–“ */ }
        .custom-info h3 { margin: 0; font-size: 1.4em; color: var(--main-theme); }
        .custom-info p { margin: 5px 0 0 0; font-size: 1.1em; font-weight: bold; color: var(--accent-color); }


        /* å®¢è£½åŒ–é¸é …å…§å®¹å€ - å”¯ä¸€å¯æ»¾å‹•å€åŸŸ */
        .custom-options-container {
            flex-grow: 1;
            overflow-y: auto; 
            padding: 20px;
            -webkit-overflow-scrolling: touch;
        }
        .option-box { background-color: var(--light-bg); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); }
        .option-box label { display: block; font-weight: bold; margin-bottom: 15px; font-size: 1.2em; color: var(--main-theme); }
        
        /* é¸é …æŒ‰éˆ•çµ„ */
        .option-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .option-group button {
            background-color: var(--light-bg);
            border: 2px solid #ddd;
            padding: 15px 10px;
            border-radius: 8px;
            font-size: 1em;
            color: var(--main-text);
            transition: all 0.2s;
            cursor: pointer;
        }
        /* é¸ä¸­æŒ‰éˆ•æ¨£å¼ */
        .option-group button.active {
            background-color: var(--active-bg-day);
            color: white;
            border-color: var(--active-border-day);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        }
        
        /* ç”¢å“è©³ç´°ä»‹ç´¹ */
        .product-detail-box {
            background-color: var(--light-bg);
            border-left: 5px solid var(--main-theme);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .product-detail-box h4 { color: var(--main-theme); margin: 0 0 5px 0; font-size: 1.1em; }
        .product-detail-box p { font-size: 0.9em; color: #666; margin: 0 0 5px 0; line-height: 1.4; }
        
        /* æ•¸é‡æ§åˆ¶ */
        .quantity-control { display: flex; align-items: center; justify-content: center; margin-top: 20px; }
        .qty-btn { background-color: var(--main-theme); color: white; border: none; width: 50px; height: 50px; font-size: 2em; border-radius: 50%; cursor: pointer; }
        .qty-btn:disabled { background-color: var(--disabled-color); cursor: not-allowed; }
        .quantity-display { font-size: 2em; font-weight: bold; margin: 0 20px; width: 50px; text-align: center; }

        /* åº•éƒ¨ï¼šåŠ å…¥è¨‚å–® */
        .custom-footer { 
            flex-shrink: 0; 
            background-color: #fff; 
            padding: 15px 20px; 
            border-top: 5px solid var(--accent-color); 
        }
        .custom-footer-content { display: flex; justify-content: space-between; align-items: center; }
        .custom-total-display { font-size: 1.5em; font-weight: bold; color: var(--accent-color); }
        .add-to-order-btn { background-color: var(--accent-color); color: white; padding: 15px 25px; border: none; border-radius: 8px; font-size: 1.2em; cursor: pointer; }


        /* --- RWDï¼šæ‰‹æ©Ÿ/æƒç¢¼æ¨¡å¼ (å¯¬åº¦å°æ–¼ 600px) --- */
        @media (max-width: 600px) {
            body { padding-top: 0; }
            .kiosk-container { width: 100%; height: 100vh; max-height: 100vh; border-radius: 0; box-shadow: none; }
            .menu-items { grid-template-columns: 1fr; gap: 10px; }
            .custom-header { padding-left: 50px; } 
            .custom-header-img { margin-left: 0; }
            .back-button { left: 5px; top: 15px; transform: none; }
        }
    </style>
</head>
<body id="kioskBody">

    <div class="kiosk-container">

        <div class="top-bar">
            <div class="mode-switcher">
                <p style="margin: 0 0 5px 0; font-size: 0.75em; color: #888;">**å ´æ™¯å‰µæ–°**ï¼šæ—¥èŒ¶å¤œé…’æ¨¡å¼ï¼Œæå‡åªæ•ˆ</p>
                <button id="dayModeBtn" class="active-mode">â˜€ï¸ æ—¥èŒ¶æ¨¡å¼</button>
                <button id="nightModeBtn">ğŸ¸ å¤œé…’æ¨¡å¼</button>
            </div>
            <div class="header">
                <h1 id="kioskTitle">ä»™ (Xian) Kiosk è‡ªå‹•é»é¤</h1>
                <p id="kioskSubtitle">æ–°é¤Šç”Ÿé£²å“ | é«˜æ•ˆç‡é»é¤æµç¨‹ | **ç„¡ç³–æ¨™é…ï¼Œå¥åº·å„ªå…ˆ**</p>
            </div>
        </div>

        <div class="main-content">
            <div class="menu-items-container">
                <div class="menu-items" id="menu-list">
                    </div>
            </div>
        </div>

        <div class="order-panel">
            <div class="order-summary">
                <h2>ğŸ“‹ è¨‚å–®é è¦½</h2>
                <ul id="order-list" class="order-list">
                    <li>å°šæœªé»é¸å“é …</li>
                </ul>
            </div>
            <div class="order-footer">
                <div class="total-display" id="total-price">
                    ç¸½è¨ˆ: NT$ 0
                </div>
                <button class="checkout-btn">æ—¥èŒ¶çµå¸³</button>
            </div>
        </div>
        
        <div id="customizationPage" class="customization-page">
            
            <div class="custom-header">
                <button class="back-button" onclick="closeCustomizationPage()" aria-label="è¿”å›èœå–®">&leftarrow;</button>
                <img id="customImage" class="custom-header-img" src="" alt="é£²å“åœ–ç‰‡" onerror="this.onerror=null;this.src='https://via.placeholder.com/400x300?text=Image'">
                <div class="custom-info">
                    <h3 id="customDrinkName">å®¢è£½åŒ–ï¼šå“å</h3>
                    <p id="customDrinkBasePrice"></p>
                </div>
            </div>

            <div class="custom-options-container">
                
                <div class="product-detail-box">
                    <h4 id="detailTitle">ç”¢å“ä»‹ç´¹èˆ‡åŸºåº•ç‰©æ–™</h4>
                    <p id="detailDescription"></p>
                    <p id="detailMaterial"></p>
                </div>
                
                <div class="option-box" id="step1Option">
                    <label id="step1Label">æ­¥é©Ÿä¸€ï¼šç”œåº¦èª¿æ•´</label>
                    <div class="option-group" data-group="step1" id="step1Group"></div>
                    <div class="sugar-note" id="step1Note" style="margin-top: 15px;"></div>
                </div>

                <div class="option-box">
                    <label>æ­¥é©ŸäºŒï¼šæº«åº¦é¸æ“‡</label>
                    <div class="option-group" data-group="temp">
                        <button data-value="æ­£å¸¸å†°" data-price="0">æ­£å¸¸å†°</button>
                        <button data-value="å°‘å†°" data-price="0">å°‘å†°</button>
                        <button data-value="å»å†°" data-price="0">å»å†°</button>
                        <button data-value="æº«" data-price="0">æº«</button>
                        <button data-value="ç†±" data-price="0">ç†±</button>
                    </div>
                </div>
                
                <div class="option-box">
                    <label>æ­¥é©Ÿä¸‰ï¼šé…æ–™åŠ è³¼ (é¸é…)</label>
                    <div class="option-group" data-group="topping">
                        <button data-value="å¥‡äºç±½" data-price="10">å¥‡äºç±½ (+10)</button>
                        <button data-value="è˜†è–ˆç²’" data-price="15">è˜†è–ˆç²’ (+15)</button>
                        <button data-value="ç„¡" data-price="0">ç„¡</button>
                    </div>
                </div>
                
                <div class="option-box">
                    <label>æ­¥é©Ÿå››ï¼šé¸æ“‡æ•¸é‡</label>
                    <div class="quantity-control">
                        <button class="qty-btn" id="decreaseQty" onclick="updateQuantity(-1)">-</button>
                        <div class="quantity-display" id="itemQuantity">1</div>
                        <button class="qty-btn" id="increaseQty" onclick="updateQuantity(1)">+</button>
                    </div>
                </div>

            </div>
            
            <div class="custom-footer">
                <div class="custom-footer-content">
                    <div class="custom-total-display">
                        å°è¨ˆ: NT$<span id="customCurrentPrice">0</span>
                    </div>
                    <button class="add-to-order-btn" onclick="addItemToOrder()">åŠ å…¥è¨‚å–®</button>
                </div>
            </div>

        </div>

        <div id="materialModal" class="modal">
            <div class="custom-content" style="max-width: 400px;">
                <span class="close-btn" onclick="closeModal('materialModal')">&times;</span>
                <h2 class="material-title" id="materialName" style="font-size: 1.5em;"></h2>
                <div class="material-description" id="materialDesc" style="line-height: 1.5;"></div>
            </div>
        </div>

    </div>

    <script>
        // --- JavaScript è³‡æ–™åº« (ä¿æŒä¸è®Š) ---
        const menuData = {
            'day': [
                { id: 1, name: 'æ¡‚åœ“ç´…æ£—èŒ¶', basePrice: 75, material: 'ç´…æ£—', description: 'æº«æ½¤æ»‹è£œçš„åŸºç¤èŒ¶é£²ã€‚', image: 'day_red_date_tea.webp' },
                { id: 2, name: 'å†·èƒçƒé¾é’', basePrice: 60, material: 'çƒé¾èŒ¶è‘‰', description: 'ä½å’–å•¡å› å†·æ³¡å·¥è—ã€‚', image: 'day_cold_brew_oolong.webp' },
                { id: 3, name: 'é»‘ç³–è–‘æ¯æš–é£²', basePrice: 85, material: 'è€è–‘', description: 'é‡å°å¯’æ€§é«”è³ªè¨­è¨ˆã€‚', image: 'day_ginger_warming_drink.webp' },
                { id: 4, name: 'æ´›ç¥èŠ±æœèŒ¶', basePrice: 70, material: 'æ´›ç¥èŠ±', description: 'å¤©ç„¶é…¸ç”œï¼Œå¯Œå«èŠ±é’ç´ ã€‚', image: 'day_roselle_fruit_tea.webp' },
                { id: 5, name: 'ç¶“å…¸å››å­£é’èŒ¶', basePrice: 50, material: 'å››å­£é’èŒ¶è‘‰', description: 'æ¸…çˆ½è§£è†©ï¼Œæœ€å—æ­¡è¿çš„åŸºåº•èŒ¶ã€‚', image: 'day_four_seasons_tea.webp' },
                { id: 6, name: 'èœ‚èœœæª¸æª¬é¤Šæ¨‚å¤š', basePrice: 80, material: 'èœ‚èœœ', description: 'å¤©ç„¶èœ‚èœœæ­é…é¤Šæ¨‚å¤šï¼Œä¿ƒé€²è…¸é“å¥åº·ã€‚', image: 'day_honey_lemon_yakult.webp' },
            ],
            'night': [
                { id: 101, name: 'æ±æ–¹ç¾äºº Gin Tonic', basePrice: 150, material: 'æ±æ–¹ç¾äººèŒ¶', description: 'ä»¥å°ç£èŒ¶ç‚ºåŸºåº•èª¿å’Œçš„æ¸…æ–°ä½é…’ç²¾é£²å“ã€‚', image: 'night_beauty_gin_tonic.webp' },
                { id: 102, name: 'é»‘ç³–æ³¢éœ¸ Irish Cream', basePrice: 180, material: 'æ„›çˆ¾è˜­å¥¶é…’', description: 'ç¶“å…¸å¥¶é…’æ­é…Qå½ˆæ³¢éœ¸ï¼Œç”œè€Œä¸è†©ã€‚', image: 'night_boba_irish_cream.webp' },
                { id: 103, name: 'ç†±ç´…é…’é¦™æ–™èŒ¶ (Non-Alcoholic å¯é¸)', basePrice: 130, material: 'è‚‰æ¡‚', description: 'æº«æš–é¦™æ–™èˆ‡é¤Šç”ŸèŒ¶çµåˆï¼Œæ”¾é¬†èº«å¿ƒã€‚', image: 'night_mulled_spice_tea.webp' },
                { id: 104, name: 'è”æèœœéœ²æ°£æ³¡é…’', basePrice: 160, material: 'è”æ', description: 'æœé¦™æ¿ƒéƒï¼Œæ¸…çˆ½æ°£æ³¡æ„Ÿï¼Œé©åˆç«‹åå°é…Œã€‚', image: 'night_lychee_sparkling_wine.webp' },
                { id: 105, name: 'å¨å£«å¿Œæ™®æ´±èŒ¶', basePrice: 190, material: 'æ™®æ´±èŒ¶', description: 'æ¿ƒéƒèŒ¶å‘³èˆ‡å¨å£«å¿Œçš„æ²‰ç©©çµ„åˆã€‚', image: 'night_whiskey_puer.webp' },
                { id: 106, name: 'ç«ç‘°èŠ±åœ’æ°£æ³¡æ°´', basePrice: 120, material: 'ç«ç‘°èŠ±', description: 'èŠ±é¦™åŸºåº•ï¼Œç„¡é…’ç²¾æ¸…çˆ½é¸æ“‡ã€‚', image: 'night_rose_sparkling_water.webp' },
            ]
        };

        const materialData = { 
            'ç´…æ£—': { title: 'æ–°ç–†å„ªé¸ç´…æ£—', desc: 'æˆ‘å€‘çš„ç´…æ£—ä¾†è‡ªæ–°ç–†åœ°å€ï¼Œå¯Œå«ç¶­ç”Ÿç´ Cå’Œéµè³ªã€‚**ç„¡äººå·¥ç‡»ç¡«è™•ç†**ã€‚' },
            'çƒé¾èŒ¶è‘‰': { title: 'å°ç£é«˜å±±æ‰‹æ‘˜çƒé¾', desc: 'å†·èƒæŠ€è¡“èƒå–ï¼Œå£æ„Ÿå›ç”˜ï¼Œ**èŒ¶å¤šé…šå«é‡é«˜**ã€‚' },
            'è€è–‘': { title: 'å—æŠ•ç«¹è–‘', desc: 'é¸ç”¨å—æŠ•åœ°å€çš„å„ªè³ªç«¹è–‘ï¼Œè–‘å‘³æ¿ƒéƒã€‚**éæ¿ƒç¸®é‚„åŸ**ã€‚' },
            'æ´›ç¥èŠ±': { title: 'å°æ±æ´›ç¥èŠ±', desc: 'åš´é¸å°æ±å°è¾²æ´›ç¥èŠ±ï¼Œå¤©ç„¶é…¸ç”œã€‚**ç„¡äººå·¥è‰²ç´ æ·»åŠ **ã€‚' },
            'æ±æ–¹ç¾äººèŒ¶': { title: 'æ±æ–¹ç¾äººèŒ¶åŸºåº•', desc: 'ç‰¹é¸é ‚ç´šæ±æ–¹ç¾äººèŒ¶ï¼Œèˆ‡ç´é…’èª¿å’Œå¾Œå£æ„Ÿå¹³è¡¡ã€‚**ä½åº¦é…’ç²¾èª¿å’Œ**ã€‚' },
            'æ„›çˆ¾è˜­å¥¶é…’': { title: 'é ‚ç´šæ„›çˆ¾è˜­å¥¶é…’', desc: 'ä½¿ç”¨é«˜å“è³ªæ„›çˆ¾è˜­å¨å£«å¿Œå’Œé®®å¥¶æ²¹è£½æˆï¼Œç¢ºä¿å¤œé–“é£²å“çš„å“è³ªæ„Ÿã€‚**é«˜å“è³ªåŸæ–™ç¢ºä¿å¤œé…’å“è³ª**ã€‚' },
            'è‚‰æ¡‚': { title: 'æœ‰æ©ŸéŒ«è˜­è‚‰æ¡‚', desc: 'æ¡ç”¨é«˜å“è³ªéŒ«è˜­è‚‰æ¡‚ï¼Œé¦™æ°£æº«å’Œã€‚' },
            'è”æ': { title: 'æ–°é®®å†·å‡è”ææœè‚‰', desc: 'é¸ç”¨ç•¶å­£æ–°é®®è”æå¿«é€Ÿå†·å‡ï¼Œæ­é…æ°£æ³¡é…’å£æ„Ÿæ¸…çˆ½ã€‚' },
            'å››å­£é’èŒ¶è‘‰': { title: 'å°ç£å°è‘‰ç¨®å››å­£é’', desc: 'æ¸…é¦™å‹å°è‘‰ç¨®é’èŒ¶ï¼Œæ¡ç”¨è¼•ç™¼é…µå·¥è—ï¼Œé©åˆç„¡ç³–é£²ç”¨ã€‚' },
            'èœ‚èœœ': { title: 'å±æ±é¾çœ¼èŠ±èœœ', desc: 'å¤©ç„¶å±æ±é¾çœ¼èŠ±èœœï¼Œç”œå‘³å¤©ç„¶ä¸æ­»ç”œï¼Œæ˜¯æˆ‘å€‘æ¨è–¦çš„ä»˜è²»ç”œåº¦é…æ–™ã€‚' },
            'æ™®æ´±èŒ¶': { title: 'é›²å—é™³å¹´æ™®æ´±', desc: 'ç²¾é¸é™³å¹´ç†Ÿæ™®æ´±ï¼ŒèŒ¶æ¹¯é†‡åšï¼Œèˆ‡å¨å£«å¿Œæ­é…èƒ½ç”¢ç”Ÿç¨ç‰¹çš„ç…™ç‡»å£æ„Ÿã€‚' },
            'ç«ç‘°èŠ±': { title: 'å¤§é¦¬å£«é©ç«ç‘°èŠ±ç“£', desc: 'é¸ç”¨é£Ÿç”¨ç´šå¤§é¦¬å£«é©ç«ç‘°èŠ±ç“£ï¼ŒèŠ±é¦™æ¿ƒéƒè‡ªç„¶ï¼Œç„¡è¾²è—¥æ®˜ç•™ã€‚' },
        };

        let currentMode = 'day';
        let currentSelectedItem = null;
        let order = [];
        let currentQuantity = 1;
        let currentCustomizationBasePrice = 0;

        function setMode(mode) { 
            currentMode = mode;
            const body = document.getElementById('kioskBody');
            const dayBtn = document.getElementById('dayModeBtn');
            const nightBtn = document.getElementById('nightModeBtn');

            if (mode === 'night') {
                body.classList.add('night-mode');
                nightBtn.classList.add('active-mode');
                dayBtn.classList.remove('active-mode');
                document.getElementById('kioskTitle').innerHTML = 'ä»™ (Xian) ğŸ¸ å¤œé…’ Kiosk';
                document.getElementById('kioskSubtitle').innerHTML = 'å¤œé–“å°ˆå±¬èª¿é£² | **ç«‹åæ–‡åŒ–** | **é«˜åªæ•ˆå»¶é•·ç‡Ÿæ¥­æ™‚é–“**';
                document.querySelector('.checkout-btn').textContent = 'å¤œé…’çµå¸³';
            } else {
                body.classList.remove('night-mode');
                dayBtn.classList.add('active-mode');
                nightBtn.classList.remove('active-mode');
                document.getElementById('kioskTitle').innerHTML = 'ä»™ (Xian) ğŸŒ¤ï¸ Kiosk è‡ªå‹•é»é¤';
                document.getElementById('kioskSubtitle').innerHTML = 'æ–°é¤Šç”Ÿé£²å“ | é«˜æ•ˆç‡é»é¤æµç¨‹ | **ç„¡ç³–æ¨™é…ï¼Œå¥åº·å„ªå…ˆ**';
                document.querySelector('.checkout-btn').textContent = 'æ—¥èŒ¶çµå¸³';
            }
            
            renderMenu(menuData[mode]);
        }

        function renderMenu(data) { 
            const menuList = document.getElementById('menu-list');
            menuList.innerHTML = '';
            
            if (order.length === 0) {
                 document.getElementById('order-list').innerHTML = '<li>å°šæœªé»é¸å“é …</li>';
            }

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.innerHTML = `
                    <button class="info-btn" data-material="${item.material}" style="position: absolute; top: 5px; right: 5px; z-index: 10;">i</button>
                    <img src="./images/${item.image}" alt="${item.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/400x300?text=Placeholder'">
                    <div class="item-card-text">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <p class="price">NT$ ${item.basePrice}</p>
                    </div>
                `;
                card.onclick = (e) => {
                    if (!e.target.classList.contains('info-btn')) {
                        openCustomizationPage(item); 
                    }
                };

                menuList.appendChild(card);
            });

            document.querySelectorAll('.info-btn').forEach(btn => {
                btn.onclick = (e) => {
                    e.stopPropagation();
                    const materialName = btn.getAttribute('data-material');
                    showMaterialInfo(materialName);
                };
            });
        }

        function showMaterialInfo(materialName) { 
            const data = materialData[materialName];
            if (!data) return;
            document.getElementById('materialName').textContent = `${materialName} (${data.title})`;
            document.getElementById('materialDesc').innerHTML = `<p>${data.desc}</p>`;
            document.getElementById('materialModal').style.display = 'block';
        }

        function closeModal(modalId) { 
            document.getElementById(modalId).style.display = 'none';
        }


        // --- å®¢è£½åŒ–é é¢æ§åˆ¶ ---

        function openCustomizationPage(item) {
            currentSelectedItem = item;
            currentQuantity = 1;

            // 1. è¨­ç½®é ‚éƒ¨ç”¢å“è³‡è¨Š
            document.getElementById('customDrinkName').textContent = item.name;
            document.getElementById('customDrinkBasePrice').textContent = `åŸºç¤åƒ¹: NT$${item.basePrice}`;
            document.getElementById('customImage').src = `./images/${item.image}`;
            
            // 2. è¼‰å…¥ç”¢å“è©³ç´°ä»‹ç´¹
            const materialInfo = materialData[item.material];
            document.getElementById('detailDescription').textContent = item.description;
            document.getElementById('detailMaterial').innerHTML = `**åŸºåº•ç‰©æ–™:** ${item.material} (${materialInfo.title})`;

            // 3. è™•ç†æ­¥é©Ÿä¸€ (ç”œåº¦/é…’ç²¾) - å‹•æ…‹ç”Ÿæˆä¸¦ç¶å®š
            const step1Label = document.getElementById('step1Label');
            const step1Group = document.getElementById('step1Group');
            const step1Note = document.getElementById('step1Note');
            step1Group.innerHTML = ''; 

            let options, noteText;
            if (currentMode === 'day') {
                step1Label.textContent = 'æ­¥é©Ÿä¸€ï¼šç”œåº¦èª¿æ•´ (ç„¡ç³–æ¨™é…ï¼Œå¥åº·å¿ƒæ™º)';
                step1Group.setAttribute('data-group', 'sugar');
                options = [
                    { value: "ç„¡ç³–", price: 0, text: "ç„¡ç³– (NT$0)" },
                    { value: "å¾®ç³–(èœ‚èœœ)", price: 10, text: "å¾®ç³– (èœ‚èœœ +10)" },
                    { value: "åŠç³–(è”—ç³–)", price: 15, text: "åŠç³– (è”—ç³– +15)" }
                ];
                noteText = 'âœ… <b>ç„¡ç³–æ¨™é…</b>ï¼šç”œåº¦ç‚ºä»˜è²»å®¢è£½åŒ–é…æ–™ï¼Œé¼“å‹µå¤©ç„¶å£å‘³ã€‚';
            } else {
                step1Label.textContent = 'æ­¥é©Ÿä¸€ï¼šé…’ç²¾å¼·åº¦ (å¤œé…’æ¨¡å¼ï¼Œé«˜å®¢å–®åƒ¹)';
                step1Group.setAttribute('data-group', 'alcohol');
                options = [
                    { value: "ç„¡é…’ç²¾", price: 0, text: "ç„¡é…’ç²¾èª¿å’Œ (NT$0)" },
                    { value: "å¾®é†º(3%)", price: 30, text: "å¾®é†º (3% +30)" },
                    { value: "æ¨™æº–(6%)", price: 50, text: "æ¨™æº– (6% +50)" }
                ];
                noteText = 'ğŸ¸ <b>ç«‹åèª¿é£²</b>ï¼šå¿«é€Ÿèª¿æ•´é…’ç²¾æ¿ƒåº¦ï¼Œç¬¦åˆå¤œé–“ç¤¾äº¤éœ€æ±‚ã€‚';
            }
            
            options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.setAttribute('data-value', opt.value);
                btn.setAttribute('data-price', opt.price);
                btn.textContent = opt.text;
                if (index === 0) btn.classList.add('active'); 
                btn.onclick = handleOptionClick; 
                step1Group.appendChild(btn);
            });
            step1Note.innerHTML = noteText;


            // 4. é‡è¨­éœæ…‹é¸é …ç‹€æ…‹ (æº«åº¦/é…æ–™)
            document.querySelectorAll('#customizationPage .option-group button').forEach(btn => {
                btn.classList.remove('active');
                
                if(btn.getAttribute('data-group') === 'temp' && btn.getAttribute('data-value') === 'æ­£å¸¸å†°') {
                    btn.classList.add('active');
                } else if (btn.getAttribute('data-group') === 'topping' && btn.getAttribute('data-value') === 'ç„¡') {
                    btn.classList.add('active');
                }
            });
            
            // 5. é¡¯ç¤ºå®¢è£½åŒ–é é¢
            document.getElementById('customizationPage').style.display = 'flex';
            
            // 6. åˆå§‹åŒ–æ•¸é‡å’Œåƒ¹æ ¼
            document.getElementById('itemQuantity').textContent = currentQuantity;
            document.getElementById('decreaseQty').disabled = true;
            calculateCustomPrice();
        }
        
        function closeCustomizationPage() {
            document.getElementById('customizationPage').style.display = 'none';
        }
        
        function handleOptionClick() {
            const group = this.parentElement;
            group.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            calculateCustomPrice(); 
        }

        function calculateCustomPrice() {
            if (!currentSelectedItem) return;

            let pricePerItem = currentSelectedItem.basePrice;

            document.querySelectorAll('#customizationPage .option-group').forEach(group => {
                const activeBtn = group.querySelector('.active');
                if (activeBtn) {
                    const priceAttr = activeBtn.getAttribute('data-price');
                    const price = parseFloat(priceAttr || 0);
                    pricePerItem += price;
                }
            });

            currentCustomizationBasePrice = pricePerItem;
            const finalPrice = pricePerItem * currentQuantity;

            document.getElementById('customCurrentPrice').textContent = finalPrice;
        }

        function updateQuantity(change) {
            currentQuantity += change;
            if (currentQuantity < 1) currentQuantity = 1;

            document.getElementById('itemQuantity').textContent = currentQuantity;
            
            document.getElementById('decreaseQty').disabled = (currentQuantity <= 1);

            calculateCustomPrice(); 
        }


        function addItemToOrder() {
            if (!currentSelectedItem) return;

            const customizations = {};
            let pricePerItem = currentSelectedItem.basePrice;

            document.querySelectorAll('#customizationPage .option-group').forEach(group => {
                const activeBtn = group.querySelector('.active');
                const groupName = group.getAttribute('data-group');
                const value = activeBtn.getAttribute('data-value');
                const price = parseFloat(activeBtn.getAttribute('data-price') || 0);
                
                if (groupName === 'step1') {
                    customizations[currentMode === 'day' ? 'sugar' : 'alcohol'] = value;
                } else {
                    customizations[groupName] = value;
                }
                
                pricePerItem += price;
            });

            for (let i = 0; i < currentQuantity; i++) {
                 const orderItem = {
                    id: currentSelectedItem.id,
                    name: currentSelectedItem.name,
                    price: pricePerItem, 
                    customizations: customizations,
                    mode: currentMode
                };
                order.push(orderItem);
            }
            
            renderOrder();
            closeCustomizationPage();
        }

        function renderOrder() {
            const orderList = document.getElementById('order-list');
            const totalDisplay = document.getElementById('total-price');
            let totalPrice = 0;

            orderList.innerHTML = '';
            
            const groupedOrder = {};
            order.forEach(item => {
                totalPrice += item.price;
                const key = JSON.stringify({ name: item.name, cust: item.customizations });
                if (!groupedOrder[key]) {
                    groupedOrder[key] = { ...item, count: 0, subtotal: 0 };
                }
                groupedOrder[key].count += 1;
                groupedOrder[key].subtotal += item.price;
            });

            Object.values(groupedOrder).forEach(item => {
                let mainCustomText = '';
                if (item.mode === 'day') {
                    const sugarText = item.customizations.sugar !== 'ç„¡ç³–' ? `<span style="color:var(--accent-color);">${item.customizations.sugar.split('(')[0]}</span>` : item.customizations.sugar;
                    mainCustomText = `${sugarText}`;
                } else {
                    const alcoholText = item.customizations.alcohol;
                    mainCustomText = `${alcoholText}`;
                }
                
                const toppingText = item.customizations.topping !== 'ç„¡' ? ` + ${item.customizations.topping}` : '';

                const li = document.createElement('li');
                li.innerHTML = `
                    <div style="display: flex; justify-content: space-between;">
                        <span>**${item.name}** x ${item.count}</span>
                        <span>NT$${item.subtotal}</span>
                    </div>
                    <small>
                        ${mainCustomText} / ${item.customizations.temp} ${toppingText}
                    </small>
                `;
                orderList.appendChild(li);
            });

            if (order.length === 0) {
                 orderList.innerHTML = '<li>å°šæœªé»é¸å“é …</li>';
            }

            totalDisplay.textContent = `ç¸½è¨ˆ: NT$ ${totalPrice}`;
        }


        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('dayModeBtn').addEventListener('click', () => setMode('day'));
            document.getElementById('nightModeBtn').addEventListener('click', () => setMode('night'));
            
            // ç¶å®šéœæ…‹é¸é …æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶
            document.querySelectorAll('#customizationPage .option-group button').forEach(button => {
                 const groupName = button.parentElement.getAttribute('data-group');
                 if (groupName !== 'step1') {
                    button.addEventListener('click', handleOptionClick);
                 }
            });
            
            setMode('day'); 

            document.querySelector('.checkout-btn').addEventListener('click', () => {
                if (order.length === 0) {
                    alert('è«‹å…ˆé»é¸é£²å“');
                    return;
                }
                const currentButtonText = document.querySelector('.checkout-btn').textContent;
                let checkoutMessage;
                
                if (currentMode === 'day') {
                    checkoutMessage = 'æ—¥èŒ¶æ¨¡å¼çµå¸³æˆåŠŸï¼è¨‚å–®å·²é€é Kiosk ç³»çµ±åŒ¯å…¥ã€Œå¼•å°å¼æµæ°´ç·šã€ã€‚';
                } else {
                    checkoutMessage = 'å¤œé…’æ¨¡å¼çµå¸³æˆåŠŸï¼è¨‚å–®å·²é€²å…¥ã€Œç«‹åèª¿é£²å€ã€ã€‚';
                }
                    
                alert(`[${currentButtonText}] åŸ·è¡Œå®Œæˆï¼\n\n${checkoutMessage}\n\næœ¬æ¬¡è¨‚å–®ç¸½è¨ˆ ${order.length} é …é£²å“ï¼Œç¸½é‡‘é¡ ${document.getElementById('total-price').textContent}`);
                
                order = [];
                renderOrder();
            });
        });
    </script>

</body>
</html>