<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>仙 (Xian) - Kiosk點餐流程模擬 (圖片尺寸建議)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- 響應式佈局策略：已修正底部遮擋問題。在手機上，主內容區塊 (main-content-area) 增加了 120px 的底部填充，確保內容不會被固定底欄 (mobile-footer) 遮蓋。 -->
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f5f5f4; /* bg-stone-100 */
        }
        /* Kiosk 螢幕在桌面版 (MD+) 上限制尺寸，但在手機上 (預設) 則佔滿視窗 */
        #kiosk-container {
            width: 100%;
            height: 100vh; /* 手機使用全高 */
            max-width: 1000px;
            box-shadow: 0 0 0 transparent; /* 手機上移除陰影 */
        }
        @media (min-width: 768px) {
            #kiosk-container {
                height: 90vh; /* 桌面限制高度 */
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
                border: 4px solid #44403c; /* stone-800 */
                border-radius: 16px;
                overflow: hidden;
            }
        }

        .step-indicator {
            transition: all 0.3s ease;
        }
        .step-indicator.active {
            background-color: #047857; /* emerald-700 */
            color: white;
            transform: scale(1.05);
        }
        .choice-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .choice-card:hover {
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.2);
            transform: translateY(-2px);
        }
        .choice-card.selected {
            border: 3px solid #059669; /* emerald-600 */
            background-color: #ecfdf5; /* emerald-50 */
            transform: scale(1.02);
        }
        .material-image {
            height: 100px; /* 固定圖片高度 */
            width: 100%;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        /* 隱藏桌面版的 Next/Price 區域，因為它們被移到固定底部欄 */
        #desktop-footer {
            display: none;
        }
        @media (min-width: 768px) {
            #desktop-footer {
                display: block; /* 桌面版顯示在左側欄底部 */
            }
            #mobile-footer {
                display: none !important; /* 桌面版隱藏固定底部欄 */
            }
        }
        
        /* 手機固定底部欄樣式 */
        #mobile-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #44403c; /* stone-800 */
            z-index: 50;
            padding: 1rem;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-0 md:p-4">

    <!-- Kiosk 主容器 -->
    <div id="kiosk-container" class="bg-white grid grid-cols-1 md:grid-cols-4 w-full">
        
        <!-- A. 桌面版左側欄 / 行動版頂部總結 (md:col-span-1) -->
        <div id="summary-panel" class="md:col-span-1 bg-stone-800 text-white p-4 md:p-6 flex flex-col order-1 md:order-none max-h-56 md:max-h-full overflow-y-auto">
            <div>
                <h3 class="text-xl md:text-2xl font-bold text-emerald-400 mb-2 md:mb-4 border-b border-emerald-700 pb-2">
                    您的客製化飲品
                </h3>
                
                <!-- 物料介紹區 -->
                <div id="material-intro" class="mb-4 md:mb-6 h-auto md:h-36 bg-stone-700 p-3 rounded-lg text-xs md:text-sm transition-all duration-300">
                    <p class="text-emerald-300 font-semibold mb-1">物料介紹：</p>
                    <p class="text-stone-300" id="intro-text">請點選物料開始製作您的養生特調。</p>
                </div>

                <!-- 當前訂單總結 -->
                <div id="current-drink" class="space-y-1 md:space-y-2 text-xs md:text-sm">
                    <p class="text-stone-300"><span class="font-semibold text-emerald-300">基底：</span> <span id="summary-base">未選</span></p>
                    <p class="text-stone-300"><span class="font-semibold text-emerald-300">配料：</span> <span id="summary-topping">未選</span></p>
                    <p class="text-stone-300"><span class="font-semibold text-emerald-300">甜度：</span> <span id="summary-sweetener">無糖 (標配)</span></p>
                </div>
            </div>
            
            <!-- 桌面版底部固定區 (行動版會隱藏，改用 #mobile-footer) -->
            <div id="desktop-footer" class="mt-4 md:mt-6 pt-4 border-t border-emerald-700">
                <p class="text-xl font-bold flex justify-between items-center">
                    總計金額：
                    <span id="total-price-desktop" class="text-3xl text-emerald-400">NT$ 0</span>
                </p>
                <button id="next-step-btn-desktop" class="w-full mt-4 py-3 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-bold text-lg transition duration-300" disabled>
                    下一步
                </button>
            </div>
        </div>

        <!-- B. 主操作區 (md:col-span-3) -->
        <!-- 修正底部遮擋，增加底部填充 -->
        <div id="main-content-area" class="md:col-span-3 p-4 md:p-6 flex flex-col order-2 md:order-none overflow-y-auto pb-[120px] md:pb-0">
            
            <!-- 品牌與步驟指示 -->
            <header class="mb-4 md:mb-6">
                <h1 class="text-3xl md:text-4xl font-bold text-emerald-700 mb-2 md:mb-3">
                    仙 · 引導式點餐
                </h1>
                <div class="flex space-x-2 text-xs font-semibold uppercase">
                    <span id="step-1-ind" class="step-indicator px-3 py-1 rounded-full bg-emerald-700 text-white active">1. 基底選擇</span>
                    <span id="step-2-ind" class="step-indicator px-3 py-1 rounded-full bg-stone-300 text-stone-700">2. 配料添加</span>
                    <span id="step-3-ind" class="step-indicator px-3 py-1 rounded-full bg-stone-300 text-stone-700">3. 甜度決定</span>
                </div>
            </header>

            <!-- 選擇內容區 -->
            <div id="selection-area" class="flex-grow">
                <!-- Content will be dynamically injected here -->
            </div>

        </div>

    </div>
    
    <!-- C. 行動版固定底部欄 (手機專用) -->
    <div id="mobile-footer" class="md:hidden">
        <p class="text-lg font-bold flex justify-between items-center text-white">
            總計金額：
            <span id="total-price-mobile" class="text-2xl text-emerald-400">NT$ 0</span>
        </p>
        <button id="next-step-btn-mobile" class="w-full mt-3 py-3 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-bold text-lg transition duration-300" disabled>
            下一步
        </button>
    </div>

    <script>
        // 核心物料數據庫 (已將圖片尺寸調整為建議的 800x600)
        const Materials = {
            base: [
                { id: 'jasmine', name: '茉莉綠茶', price: 60, intro: '清新回甘，幫助提神。純天然茶葉沖泡，適合日間飲用。', type: '日茶', imageUrl: './images/jasmine.jpg' },
                { id: 'oolong', name: '高山烏龍', price: 65, intro: '口感醇厚，富含茶多酚，有助消脂解膩。', type: '日茶', imageUrl: './images/oolong.jpg' },
                { id: 'sparkling', name: '氣泡水', price: 70, intro: '零熱量、零負擔的清爽基底，促進體內循環，保持活力。', type: '日茶', imageUrl: './images/sparklingwater.jpg' },
                { id: 'plum_wine', name: '養生梅酒', price: 150, intro: '夜間專供。低度數調飲，有助於舒緩身心，微醺養顏。', type: '夜酒', imageUrl: './images/umeshu.jpg' },
            ],
            topping: [
                { id: 'ginseng', name: '人蔘片', price: 30, intro: '珍貴養生配料，有助提升元氣，滋補強身。', is_healthy: true, imageUrl: './images/inseng.jpg' },
                { id: 'red_date', name: '紅棗', price: 20, intro: '天然甘甜，傳統養生配方，能養血安神。', is_healthy: true, imageUrl: './images/jujube.jpg' },
                { id: 'pearl', name: '手工珍珠', price: 10, intro: '少量供應的經典口感，每日新鮮熬煮，建議減量添加。', is_healthy: false, imageUrl: './images/boba.jpg' },
                { id: 'aloe', name: '蘆薈丁', price: 15, intro: '低卡飽足，幫助消化，口感清脆滑順。', is_healthy: true, imageUrl: './images/aloe.jpg' },
            ],
            sweetener: [
                { id: 'none', name: '無糖 (標配)', price: 0, intro: '保持飲品純粹風味，是「仙」品牌的預設健康選項。', pay_for_sugar: false, imageUrl: 'https://placehold.co/800x600/cbd5e1/475569?text=無糖+標準健康' },
                { id: 'honey', name: '天然蜂蜜', price: 15, intro: '付費選項。天然甜味劑，富含維生素，推薦給微奢享受者。', pay_for_sugar: true, imageUrl: './images/honey.jpg' },
                { id: 'cane_sugar', name: '手炒蔗糖', price: 10, intro: '付費選項。傳統工藝熬製，增加飲品層次感，但請留意熱量。', pay_for_sugar: true, imageUrl: './images/sucrose.jpg' },
            ]
        };

        // 應用程式狀態 (State)
        let currentState = {
            step: 1,
            selectedBase: null,
            selectedTopping: null,
            selectedSweetener: null,
            totalPrice: 0
        };

        // DOM 元素引用
        const selectionArea = document.getElementById('selection-area');
        
        // 桌面版按鈕/價格
        const nextStepBtnDesktop = document.getElementById('next-step-btn-desktop');
        const totalPriceElDesktop = document.getElementById('total-price-desktop');
        
        // 行動版按鈕/價格
        const nextStepBtnMobile = document.getElementById('next-step-btn-mobile');
        const totalPriceElMobile = document.getElementById('total-price-mobile');

        const introTextEl = document.getElementById('intro-text');
        
        // 總結面板
        const summaryBase = document.getElementById('summary-base');
        const summaryTopping = document.getElementById('summary-topping');
        const summarySweetener = document.getElementById('summary-sweetener');

        // 步驟指示器
        const stepIndicators = [
            document.getElementById('step-1-ind'),
            document.getElementById('step-2-ind'),
            document.getElementById('step-3-ind')
        ];

        // --- 核心邏輯函數 ---

        /**
         * 根據當前狀態更新步驟指示器外觀
         */
        function updateStepIndicators() {
            stepIndicators.forEach((indicator, index) => {
                indicator.classList.remove('active', 'bg-emerald-700', 'text-white');
                indicator.classList.add('bg-stone-300', 'text-stone-700');
                if (index + 1 === currentState.step) {
                    indicator.classList.add('active');
                }
                // 已完成的步驟顏色要固定
                if (index + 1 < currentState.step) {
                    indicator.classList.remove('bg-stone-300', 'text-stone-700');
                    indicator.classList.add('bg-emerald-800', 'text-white');
                }
            });
        }

        /**
         * 更新訂單總結與價格
         */
        function updateSummary() {
            currentState.totalPrice = 0;
            
            if (currentState.selectedBase) {
                currentState.totalPrice += currentState.selectedBase.price;
                summaryBase.textContent = `${currentState.selectedBase.name} (NT$ ${currentState.selectedBase.price})`;
            } else {
                summaryBase.textContent = '未選';
            }

            if (currentState.selectedTopping) {
                currentState.totalPrice += currentState.selectedTopping.price;
                summaryTopping.textContent = `${currentState.selectedTopping.name} (+NT$ ${currentState.selectedTopping.price})`;
            } else {
                summaryTopping.textContent = '未選';
            }

            if (currentState.selectedSweetener) {
                currentState.totalPrice += currentState.selectedSweetener.price;
                summarySweetener.textContent = `${currentState.selectedSweetener.name} ${currentState.selectedSweetener.price > 0 ? '(+NT$ ' + currentState.selectedSweetener.price + ')' : ''}`;
            } else {
                summarySweetener.textContent = '無糖 (標配)';
            }
            
            const priceText = `NT$ ${currentState.totalPrice}`;
            totalPriceElDesktop.textContent = priceText;
            totalPriceElMobile.textContent = priceText;

            // 檢查是否可以進入下一步
            let canProceed = false;
            if (currentState.step === 1 && currentState.selectedBase) {
                canProceed = true;
            } else if (currentState.step === 2) {
                canProceed = true; // 配料可選可不選，故可隨時進入下一步
            } else if (currentState.step === 3 && currentState.selectedSweetener) {
                canProceed = true;
            }
            
            const btnText = currentState.step === 3 ? '確認訂單並結帳' : '下一步';
            
            nextStepBtnDesktop.disabled = !canProceed;
            nextStepBtnDesktop.textContent = btnText;
            
            nextStepBtnMobile.disabled = !canProceed;
            nextStepBtnMobile.textContent = btnText;
        }

        /**
         * 渲染選項卡片
         * @param {string} category - base, topping, or sweetener
         */
        function renderOptions(category) {
            selectionArea.innerHTML = '';
            const data = Materials[category];
            
            const titleMap = {
                base: '1. 選擇飲品基底',
                topping: '2. 挑選養生配料 (可選可不選)',
                sweetener: '3. 決定飲品甜度'
            };
            const subtitleMap = {
                base: '（茶、果汁、氣泡水或夜間限定酒品）',
                topping: '（人蔘、紅棗等高價值配料，點選查看功效）',
                sweetener: '（「無糖」是標配，加糖需付費客製化）'
            };
            
            // 手機版兩欄，桌面版四欄
            const cardGridClass = 'grid grid-cols-2 lg:grid-cols-4 gap-4 pb-4'; 

            const headerHTML = `
                <h2 class="text-2xl md:text-3xl font-bold text-stone-900">${titleMap[category]}</h2>
                <p class="text-stone-600 mb-4 md:mb-6">${subtitleMap[category]}</p>
                <div class="${cardGridClass}">
            `;
            
            let cardsHTML = '';
            data.forEach(item => {
                const selectedClass = (category === 'base' && currentState.selectedBase && currentState.selectedBase.id === item.id) ||
                                      (category === 'topping' && currentState.selectedTopping && currentState.selectedTopping.id === item.id) ||
                                      (category === 'sweetener' && currentState.selectedSweetener && currentState.selectedSweetener.id === item.id)
                                      ? 'selected' : '';

                const priceText = item.price > 0 ? `+NT$ ${item.price}` : (category === 'sweetener' ? 'NT$ 0' : `NT$ ${item.price}`);
                const extraTag = item.type === '夜酒' ? '<span class="text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded-full">夜間限定</span>' : (item.is_healthy ? '<span class="text-xs bg-emerald-100 text-emerald-600 px-2 py-0.5 rounded-full">養生嚴選</span>' : '');

                cardsHTML += `
                    <div class="choice-card p-3 border border-stone-300 rounded-xl bg-white shadow-sm flex flex-col h-full ${selectedClass}" data-id="${item.id}" data-category="${category}">
                        <!-- 圖片部分：建議使用 800x600 的實拍圖 -->
                        <img src="${item.imageUrl}" alt="${item.name} 示意圖" class="material-image rounded-md mb-2" 
                             onerror="this.onerror=null;this.src='https://placehold.co/400x100/e0f2f1/064e3b?text=圖片載入失敗'" />
                        
                        <!-- 文字資訊部分 -->
                        <div class="flex flex-col flex-grow">
                            <div class="flex items-center justify-between mb-1">
                                <h3 class="text-base md:text-lg font-semibold text-stone-900">${item.name}</h3>
                                ${extraTag}
                            </div>
                            <p class="text-base md:text-lg font-bold text-emerald-600">${priceText}</p>
                            <p class="text-xs md:text-sm text-stone-500 mt-1 flex-grow">${item.intro.split('，')[0]}...</p>
                        </div>
                    </div>
                `;
            });

            selectionArea.innerHTML = headerHTML + cardsHTML + '</div>';
            
            // 添加事件監聽器
            selectionArea.querySelectorAll('.choice-card').forEach(card => {
                card.addEventListener('click', () => handleSelection(card, category));
                card.addEventListener('mouseover', () => displayIntro(card, category));
                card.addEventListener('mouseout', () => clearIntro());
            });

            // 首次渲染時，如果已經有選擇，則顯示其介紹
            if (category === 'base' && currentState.selectedBase) {
                introTextEl.textContent = currentState.selectedBase.intro;
            } else if (category === 'topping' && currentState.selectedTopping) {
                 introTextEl.textContent = currentState.selectedTopping.intro;
            } else if (category === 'sweetener' && currentState.selectedSweetener) {
                 introTextEl.textContent = currentState.selectedSweetener.intro;
            }
        }

        /**
         * 處理物料選擇邏輯
         */
        function handleSelection(card, category) {
            const itemId = card.getAttribute('data-id');
            const item = Materials[category].find(i => i.id === itemId);

            // 清除當前分類的選擇狀態
            selectionArea.querySelectorAll('.choice-card').forEach(c => c.classList.remove('selected'));
            
            // 設定新的選擇狀態
            card.classList.add('selected');

            switch (category) {
                case 'base':
                    currentState.selectedBase = item;
                    break;
                case 'topping':
                    // 配料可重複點擊取消
                    if (currentState.selectedTopping && currentState.selectedTopping.id === item.id) {
                         currentState.selectedTopping = null;
                         card.classList.remove('selected');
                    } else {
                         currentState.selectedTopping = item;
                    }
                    break;
                case 'sweetener':
                    currentState.selectedSweetener = item;
                    break;
            }

            // 選定後，將物料介紹固定顯示
            introTextEl.textContent = item.intro;
            
            updateSummary();
        }

        /**
         * 處理滑鼠懸停顯示物料介紹 (教育性引導)
         */
        function displayIntro(card, category) {
            const itemId = card.getAttribute('data-id');
            const item = Materials[category].find(i => i.id === itemId);
            if (item) {
                introTextEl.textContent = item.intro;
            }
        }

        /**
         * 清除介紹，回到已選擇項目的總結
         */
        function clearIntro() {
             if (currentState.step === 1 && currentState.selectedBase) {
                introTextEl.textContent = currentState.selectedBase.intro;
            } else if (currentState.step === 2 && currentState.selectedTopping) {
                introTextEl.textContent = currentState.selectedTopping.intro;
            } else if (currentState.step === 3 && currentState.selectedSweetener) {
                introTextEl.textContent = currentState.selectedSweetener.intro;
            } else {
                introTextEl.textContent = '請點選物料開始製作您的養生特調。';
            }
        }

        /**
         * 推進到下一個步驟
         */
        function nextStep() {
            if (currentState.step === 3) {
                // 結帳邏輯
                selectionArea.innerHTML = `
                    <div class="text-center p-8 md:p-12 bg-emerald-50 rounded-xl shadow-lg">
                        <h2 class="text-3xl md:text-4xl font-bold text-emerald-700 mb-4">✅ 訂單已送出！</h2>
                        <p class="text-lg md:text-xl text-stone-700 mb-6">您訂購的客製化飲品總計：<span class="text-2xl md:text-3xl font-extrabold text-emerald-600">${totalPriceElMobile.textContent}</span></p>
                        <p class="text-stone-600">請掃描 QR Code 或於櫃檯支付。稍候片刻，您的養生特調即將完成！</p>
                        <div class="mt-8">
                            <button onclick="resetKiosk()" class="bg-stone-700 text-white px-6 py-3 rounded-full hover:bg-stone-900 transition">重新開始點餐</button>
                        </div>
                    </div>
                `;
                nextStepBtnDesktop.disabled = true;
                nextStepBtnMobile.disabled = true;
                return;
            }

            currentState.step += 1;
            updateKioskView();
        }

        /**
         * 根據當前步驟渲染畫面
         */
        function updateKioskView() {
            updateStepIndicators();
            updateSummary();

            switch (currentState.step) {
                case 1:
                    renderOptions('base');
                    break;
                case 2:
                    renderOptions('topping');
                    break;
                case 3:
                    renderOptions('sweetener');
                    // 甜度必須選
                    if (!currentState.selectedSweetener) {
                        currentState.selectedSweetener = Materials.sweetener.find(i => i.id === 'none');
                        updateSummary();
                    }
                    break;
            }
        }

        /**
         * 重設 Kiosk 狀態
         */
        function resetKiosk() {
            currentState = {
                step: 1,
                selectedBase: null,
                selectedTopping: null,
                selectedSweetener: null,
                totalPrice: 0
            };
            introTextEl.textContent = '請點選物料開始製作您的養生特調。';
            updateKioskView();
        }

        // --- 初始化與事件監聽 ---
        
        // 確保兩個按鈕都觸發同一個 NextStep 函數
        nextStepBtnDesktop.addEventListener('click', nextStep);
        nextStepBtnMobile.addEventListener('click', nextStep);
        
        updateKioskView(); // 啟動 Kiosk
    </script>
</body>
</html>
