<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>仙 Xian - 養生特調 Kiosk 點餐系統（展示版）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f5f5f4; }
        #kiosk-container {
            width: 100%; height: 100vh; max-width: 1000px; margin: 0 auto;
        }
        @media (min-width: 768px) {
            #kiosk-container {
                height: 92vh; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                border: 6px solid #44403c; border-radius: 20px; overflow: hidden;
            }
        }
        .step-indicator { transition: all 0.3s ease; }
        .step-indicator.active { background-color: #047857; color: white; transform: scale(1.1); }
        .choice-card {
            transition: all 0.25s ease; cursor: pointer; position: relative;
            border: 3px solid transparent; border-radius: 16px; overflow: hidden;
        }
        .choice-card:hover { transform: translateY(-6px); box-shadow: 0 12px 25px rgba(5,150,105,0.25); }
        .choice-card.selected { border-color: #059669; background: linear-gradient(to bottom, #ecfdf5, #ffffff); transform: scale(1.03); }
        .material-image { height: 200px; width: 100%; object-fit: cover; }
        #mobile-footer {
            position: fixed; bottom: 0; left: 0; right: 0; background: #292524;
            z-index: 100; padding: 1rem; box-shadow: 0 -8px 20px rgba(0,0,0,0.15);
        }
        #main-content-area { padding-bottom: 140px; }
        @media (min-width: 768px) { #main-content-area { padding-bottom: 0; } #mobile-footer { display: none !important; } }
        .quantity-btn { width: 64px; height: 64px; border-radius: 50%; font-size: 36px; font-weight: bold; }
        .intro-hover { opacity: 0; transition: opacity 0.3s; }
        .choice-card:hover .intro-hover { opacity: 1; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-stone-100 p-2">

<div id="kiosk-container" class="bg-white grid grid-cols-1 md:grid-cols-4 rounded-2xl overflow-hidden">

    <!-- 左側總結面板 -->
    <div class="bg-stone-800 text-white p-6 flex flex-col order-1 md:order-none">
        <div class="flex justify-between items-center mb-4 border-b border-emerald-700 pb-3">
            <h3 class="text-2xl font-bold text-emerald-400">您的養生特調</h3>
            <button id="view-cart-btn" class="bg-sky-600 hover:bg-sky-700 px-4 py-2 rounded-full text-sm font-bold transition">
                購物車 (<span id="cart-count">0</span>)
            </button>
        </div>

        <div id="material-intro" class="mb-6 bg-stone-700 p-4 rounded-xl text-sm">
            <p class="text-emerald-300 font-bold mb-1">物料介紹：</p>
            <p class="text-stone-200" id="intro-text">請點選開始製作您的養生飲品～</p>
        </div>

        <div id="current-drink" class="space-y-3 text-sm flex-grow">
            <p><span class="text-emerald-300 font-bold">基底：</span> <span id="summary-base">未選</span></p>
            <p><span class="text-emerald-300 font-bold">配料：</span> <span id="summary-topping">無</span></p>
            <p><span class="text-emerald-300 font-bold">冰量/溫度：</span> <span id="summary-ice">未選</span></p>
            <p><span class="text-emerald-300 font-bold">甜度：</span> <span id="summary-sweetener">無糖 (標配)</span></p>
            <p><span class="text-emerald-300 font-bold">數量：</span> <span id="summary-quantity">1</span> 杯</p>
        </div>

        <!-- 桌面版底部 -->
        <div class="hidden md:block mt-8 pt-6 border-t border-emerald-700">
            <div class="flex justify-between items-center mb-4">
                <span class="text-2xl font-bold">總計：</span>
                <span id="total-price-desktop" class="text-4xl font-black text-emerald-400">NT$ 0</span>
            </div>
            <button id="next-step-btn-desktop" class="w-full py-4 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-xl font-bold transition" disabled>
                下一步
            </button>
        </div>
    </div>

    <!-- 主內容區 -->
    <div id="main-content-area" class="md:col-span-3 p-6 md:p-8 flex flex-col">
        <header class="mb-8">
            <h1 class="text-4xl md:text-5xl font-black text-emerald-700 mb-4">仙 · 養生特調</h1>
            <div class="flex flex-wrap gap-3 text-sm font-bold">
                <span id="step-1-ind" class="step-indicator px-4 py-2 rounded-full bg-emerald-700 text-white active">1. 基底</span>
                <span id="step-2-ind" class="step-indicator px-4 py-2 rounded-full bg-stone-300 text-stone-700">2. 配料</span>
                <span id="step-3-ind" class="step-indicator px-4 py-2 rounded-full bg-stone-300 text-stone-700">3. 冰量</span>
                <span id="step-4-ind" class="step-indicator px-4 py-2 rounded-full bg-stone-300 text-stone-700">4. 甜度</span>
            </div>
        </header>

        <div id="selection-area" class="flex-grow"></div>
    </div>
</div>

<!-- 手機底部固定欄 -->
<div id="mobile-footer" class="md:hidden bg-stone-900 text-white">
    <div class="flex justify-between items-center mb-3">
        <span class="text-xl font-bold">總計金額：</span>
        <span id="total-price-mobile" class="text-3xl font-black text-emerald-400">NT$ 0</span>
    </div>
    <button id="next-step-btn-mobile" class="w-full py-4 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-xl font-bold transition" disabled>
        下一步
    </button>
</div>

<script>
    // ================ 完整資料庫（內建備援圖片）===============
        const Materials = {
            base: [
                { id: 'jasmine', name: '茉莉綠茶', price: 60, intro: '清新回甘，幫助提神。純天然茶葉沖泡，適合日間飲用。', type: '日茶', imageUrl: './images/jasmine.jpg' },
                { id: 'oolong', name: '高山烏龍', price: 65, intro: '口感醇厚，富含茶多酚，有助消脂解膩。', type: '日茶', imageUrl: './images/oolong.jpg' },
                { id: 'sparkling', name: '氣泡水', price: 70, intro: '零熱量、零負擔的清爽基底，促進體內循環，保持活力。', type: '日茶', imageUrl: './images/sparklingwater.jpg' },
                { id: 'plum_wine', name: '養生梅酒', price: 150, intro: '夜間專供。低度數調飲，有助於舒緩身心，微醺養顏。', type: '夜酒', imageUrl: './images/umeshu.jpg' },
            ],
            topping: [
                { id: 'ginseng', name: '人蔘片', price: 30, intro: '珍貴養生配料，有助提升元氣，滋補強身。', is_healthy: true, imageUrl: './images/inseng.jpg' },
                { id: 'red_date', name: '紅棗', price: 20, intro: '天然甘甜，傳統養生配方，能養血安神。', is_healthy: true, imageUrl: './images/jujube.jpg' },
                { id: 'pearl', name: '手工珍珠', price: 10, intro: '少量供應的經典口感，每日新鮮熬煮，建議減量添加。', is_healthy: false, imageUrl: './images/boba.jpg' },
                { id: 'aloe', name: '蘆薈丁', price: 15, intro: '低卡飽足，幫助消化，口感清脆滑順。', is_healthy: true, imageUrl: './images/aloe.jpg' },
            ],
            sweetener: [
                { id: 'none', name: '無糖 (標配)', price: 0, intro: '保持飲品純粹風味，是「仙」品牌的預設健康選項。', pay_for_sugar: false, imageUrl: 'https://placehold.co/800x600/cbd5e1/475569?text=無糖+標準健康' },
                { id: 'honey', name: '天然蜂蜜', price: 15, intro: '付費選項。天然甜味劑，富含維生素，推薦給微奢享受者。', pay_for_sugar: true, imageUrl: './images/honey.jpg' },
                { id: 'cane_sugar', name: '手炒蔗糖', price: 10, intro: '付費選項。傳統工藝熬製，增加飲品層次感，但請留意熱量。', pay_for_sugar: true, imageUrl: './images/sucrose.jpg' },
            ]
        };
    const IceOptions = [
        { id: 'hot', name: '熱飲', intro: '暖心暖胃，冬季首選', icon: 'Hot' },
        { id: 'warm', name: '溫飲', intro: '溫度適中，保護腸胃', icon: 'Warm' },
        { id: 'less', name: '少冰', intro: '微涼不刺激', icon: 'Light Ice' },
        { id: 'micro', name: '微冰', intro: '保留茶香', icon: 'Micro Ice' },
        { id: 'normal', name: '正常冰', intro: '經典冰涼', icon: 'Ice' },
    ];
    Materials.ice = IceOptions;

    // ================ 狀態與元素 ================
    let cart = [];
    let state = { step: 1, qty: 1, base: null, topping: null, ice: null, sugar: null, price: 0 };

    const el = {
        area: document.getElementById('selection-area'),
        intro: document.getElementById('intro-text'),
        summary: {
            base: document.getElementById('summary-base'),
            topping: document.getElementById('summary-topping'),
            ice: document.getElementById('summary-ice'),
            sugar: document.getElementById('summary-sweetener'),
            qty: document.getElementById('summary-quantity')
        },
        price: { d: document.getElementById('total-price-desktop'), m: document.getElementById('total-price-mobile') },
        btn: { d: document.getElementById('next-step-btn-desktop'), m: document.getElementById('next-step-btn-mobile') },
        cartCount: document.getElementById('cart-count'),
        steps: [...document.querySelectorAll('.step-indicator')]
    };

    // ================ 核心函數 ================
    const updateUI = () => {
        // 步驟指示器
        el.steps.forEach((s,i) => {
            s.className = 'step-indicator px-4 py-2 rounded-full transition-all';
            if (i+1 < state.step) s.classList.add('bg-emerald-800','text-white');
            else if (i+1 === state.step) s.classList.add('bg-emerald-700','text-white','active');
            else s.classList.add('bg-stone-300','text-stone-700');
        });

        // 總結與價格
        let p = 0;
        el.summary.base.textContent = state.base ? `${state.base.name} (NT$${state.base.price})` : '未選'; p += state.base?.price || 0;
        el.summary.topping.textContent = state.topping ? `${state.topping.name} (+NT$${state.topping.price})` : '無'; p += state.topping?.price || 0;
        el.summary.ice.textContent = state.ice?.name || '未選';
        el.summary.sugar.textContent = state.sugar ? `${state.sugar.name}${state.sugar.price>0?' (+NT$'+state.sugar.price+')':''}` : '無糖';
        el.summary.qty.textContent = state.qty;
        state.price = p;
        const total = p * state.qty;
        el.price.d.textContent = el.price.m.textContent = `NT$ ${total}`;
        el.cartCount.textContent = cart.length;

        // 按鈕
        const canNext = (state.step===1 && state.base) || (state.step===2) || (state.step===3 && state.ice) || (state.step===4);
        const btnText = state.step===4 ? `加入購物車 (${total}元)` : '下一步 →';
        el.btn.d.textContent = el.btn.m.textContent = btnText;
        el.btn.d.disabled = el.btn.m.disabled = !canNext;
    };

    const selectItem = (card, cat) => {
        const id = card.dataset.id;
        const item = cat==='ice' ? IceOptions.find(x=>x.id===id) : Materials[cat].find(x=>x.id===id);
        
        document.querySelectorAll(`.choice-card[data-category="${cat}"]`).forEach(c=>c.classList.remove('selected'));
        if (cat==='topping' && state.topping?.id===id) { state.topping = null; }
        else {
            card.classList.add('selected');
            state[cat==='ice'?'ice':cat==='base'?'base':cat==='topping'?'topping':'sugar'] = item;
        }
        el.intro.textContent = item.intro;
        updateUI();
    };

    const next = () => { state.step===4 ? addToCart() : (state.step++, renderStep()); };
    const addToCart = () => {
        if (!state.base || !state.ice) { alert('請完成必選項目！'); return; }
        cart.push({
            id: Date.now(),
            name: `${state.base.name} (${state.ice.name})`,
            detail: `${state.topping?.name||'無配料'}・${state.sugar?.name||'無糖'}`,
            price: state.price * state.qty,
            qty: state.qty
        });
        alert(`已加入 ${state.qty} 杯「${state.base.name}」！`);
        Object.assign(state, {step:1, qty:1, base:null, topping:null, ice:null, sugar:null});
        renderStep();
    };

    const renderStep = () => {
        updateUI();
        const map = {1:'base',2:'topping',3:'ice',4:'sweetener'};
        const data = map[state.step]==='ice' ? IceOptions : Materials[map[state.step]];
        const titles = {base:'選擇基底', topping:'添加配料（可略過）', ice:'冰量／溫度', sweetener:'甜度選擇'};

        let html = `<h2 class="text-4xl font-black mb-8 text-stone-800">${titles[map[state.step]]}</h2>`;
        html += '<div class="grid grid-cols-2 lg:grid-cols-4 gap-6">';

        data.forEach(item => {
            const selected = (
                (state.step===1 && state.base?.id===item.id) ||
                (state.step===2 && state.topping?.id===item.id) ||
                (state.step===3 && state.ice?.id===item.id) ||
                (state.step===4 && state.sugar?.id===item.id)
            );
            const tag = item.type==='夜酒' ? '夜間限定' : (item.healthy ? '養生嚴選' : '');
            html += `
            <div class="choice-card ${selected?'selected':''}" data-id="${item.id}" data-category="${map[state.step]}">
                <img src="${item.img||item.imageUrl}" class="material-image" onerror="this.src='https://placehold.co/800x600/e7f5ef/064e3b?text=仙'">
                <div class="p-5">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xl font-bold">${item.name}</h3>
                        ${tag?`<span class="text-xs px-3 py-1 rounded-full ${item.type==='夜酒'?'bg-red-100 text-red-700':'bg-emerald-100 text-emerald-700'}">${tag}</span>`:''}
                    </div>
                    <p class="text-2xl font-black text-emerald-600">${item.price>0?'+'+item.price:'標配'}</p>
                    <p class="text-sm text-stone-600 mt-3 intro-hover">${item.intro}</p>
                </div>
            </div>`;
        });
        html += '</div>';

        if (state.step===4) {
            html += `
            <div class="mt-12 bg-gradient-to-r from-emerald-50 to-sky-50 rounded-3xl p-10 text-center">
                <h3 class="text-3xl font-black mb-8">選擇數量</h3>
                <div class="flex items-center justify-center gap-10">
                    <button onclick="state.qty=Math.max(1,state.qty-1);document.getElementById('qty-input').value=state.qty;updateUI()" class="quantity-btn bg-red-500 hover:bg-red-600 text-white shadow-xl">-</button>
                    <input id="qty-input" type="number" value="${state.qty}" min="1" class="w-32 text-6xl font-black text-center bg-transparent" onchange="state.qty=Math.max(1,parseInt(this.value)||1);updateUI()">
                    <button onclick="state.qty++;document.getElementById('qty-input').value=state.qty;updateUI()" class="quantity-btn bg-sky-500 hover:bg-sky-600 text-white shadow-xl">+</button>
                </div>
            </div>`;
            if (!state.sugar) { state.sugar = Materials.sweetener[0]; updateUI(); }
        }

        el.area.innerHTML = html;
        document.querySelectorAll('.choice-card').forEach(c => c.onclick = () => selectItem(c, map[state.step]));
    };

    // 購物車與結帳
    document.getElementById('view-cart-btn').onclick = () => {
        if (cart.length===0) {
            el.area.innerHTML = `<div class="text-center py-24"><h2 class="text-5xl font-black mb-8">購物車是空的</h2><button onclick="renderStep()" class="bg-emerald-600 text-white px-12 py-6 rounded-full text-3xl hover:bg-emerald-700">開始點餐</button></div>`;
            return;
        }
        const total = cart.reduce((s,i)=>s+i.price,0);
        el.area.innerHTML = `
            <h2 class="text-5xl font-black mb-10">購物車</h2>
            <div class="space-y-6 mb-10">
                ${cart.map(item=>`
                <div class="bg-white rounded-2xl p-6 shadow-lg flex justify-between items-center">
                    <div>
                        <div class="text-2xl font-bold">${item.name} × ${item.qty}</div>
                        <div class="text-stone-600">${item.detail}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-black text-emerald-600">NT$ ${item.price}</div>
                        <button onclick="cart=cart.filter(x=>x.id!==${item.id});this.closest('div').remove();updateUI();if(cart.length===0)document.getElementById('view-cart-btn').click()" class="text-red-500 mt-2">移除</button>
                    </div>
                </div>`).join('')}
            </div>
            <div class="bg-gradient-to-r from-emerald-500 to-teal-600 rounded-3xl p-10 text-white text-center">
                <div class="text-4xl font-black mb-4">訂單總金額</div>
                <div class="text-7xl font-black">NT$ ${total}</div>
            </div>
            <div class="mt-10 grid grid-cols-1 md:grid-cols-2 gap-6">
                <button onclick="renderStep()" class="py-6 bg-stone-700 hover:bg-stone-800 text-white rounded-2xl text-2xl font-bold">繼續點餐</button>
                <button onclick="el.area.innerHTML='<div class=\\'text-center py-32\\'><h2 class=\\'text-7xl font-black text-emerald-600 mb-8\\'>訂單完成！</h2><p class=\\'text-4xl mb-12\\'>感謝您的光臨</p><div class=\\'text-8xl font-black text-emerald-700 mb-12\\'>NT$ ${total}</div><button onclick=\\'cart=[];renderStep()\\' class=\\'bg-stone-800 text-white px-16 py-8 rounded-full text-4xl hover:bg-black\\'>再來一單</button></div>';updateUI()" class="py-6 bg-sky-600 hover:bg-sky-700 text-white rounded-2xl text-2xl font-bold">立即結帳</button>
            </div>`;
    };

    // 初始化
    el.btn.d.onclick = el.btn.m.onclick = next;
    renderStep();
</script>
</body>
</html>
